<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{TITLE}}</title>
  <link rel="stylesheet" href="/style.css">
</head>
<body>
{{HEADER}}
<div class='container'>
  <h2>Device Dashboard</h2>
  <div class='water-tank-section'>
    <h3>Real-Time Water Level</h3>
    <div class='tank-visual'>
      <svg id='tank-svg' viewBox='0 0 120 240' width='120' height='240'>
        <rect x='20' y='20' width='80' height='200' rx='30' fill='#e0e0e0' stroke='#2196f3' stroke-width='4'/>
        <rect id='water-fill' x='20' y='220' width='80' height='0' rx='30' fill='#21cbf3'/>
        <text id='level-text' x='60' y='130' text-anchor='middle' font-size='24' fill='#1976d2' font-weight='bold' textLength='80' lengthAdjust='spacingAndGlyphs'>{{LEVEL_STR}}</text>
      </svg>
    </div>
  </div>
  <div class='dashboard-grid'>
    <a href='/settings/wifi' class='dashboard-widget'>
      <span class='widget-icon'>&#128279;</span>
      <span class='widget-label'>WiFi</span>
    </a>
    <a href='/settings/mqtt' class='dashboard-widget'>
      <span class='widget-icon'>&#9729;</span>
      <span class='widget-label'>MQTT</span>
    </a>
    <a href='/settings/tank' class='dashboard-widget'>
      <span class='widget-icon'>&#128738;</span>
      <span class='widget-label'>Tank</span>
    </a>
    <a href='/settings/sensor' class='dashboard-widget'>
      <span class='widget-icon'>&#128246;</span>
      <span class='widget-label'>Sensor</span>
    </a>
    <a href='/settings/display' class='dashboard-widget'>
      <span class='widget-icon'>&#128161;</span>
      <span class='widget-label'>Display</span>
    </a>
    <a href='/settings/network' class='dashboard-widget'>
      <span class='widget-icon'>&#127760;</span>
      <span class='widget-label'>Network</span>
    </a>
    <a href='/settings/alerts' class='dashboard-widget'>
      <span class='widget-icon'>&#128276;</span>
      <span class='widget-label'>Alerts</span>
    </a>
    <a href='/settings/device' class='dashboard-widget'>
      <span class='widget-icon'>&#9881;</span>
      <span class='widget-label'>Device</span>
    </a>
    <a href='/logs' class='dashboard-widget'>
      <span class='widget-icon'>&#128221;</span>
      <span class='widget-label'>Logs</span>
    </a>
    <a href='/help' class='dashboard-widget'>
      <span class='widget-icon'>&#10067;</span>
      <span class='widget-label'>Help</span>
    </a>
  </div>
</div>
<script>
let currentLevel = 0;
function animateTank(target, label) {
  const fill = document.getElementById('water-fill');
  const text = document.getElementById('level-text');
  let displayed = currentLevel;
  function step() {
    displayed += (target - displayed) * 0.15;
    if (Math.abs(displayed - target) < 0.2) displayed = target;
    let h = Math.max(0, Math.min(200, 2 * displayed));
    fill.setAttribute('y', 220 - h);
    fill.setAttribute('height', h);
    if (label !== undefined) text.textContent = label;
    if (displayed !== target) requestAnimationFrame(step);
    else currentLevel = target;
  }
  step();
}
function pollLevel() {
  fetch('/api/level').then(r => r.json()).then(data => {
    let configUnit = '{{OUTPUT_UNIT}}';
    let tankDepth = {{TANK_DEPTH}};
    let distance = {{DISTANCE}};
    let percent = data.level;
    let label = '';
    if (configUnit === 'cm') {
      let levelCm = tankDepth - distance;
      if (levelCm < 0) levelCm = 0;
      label = levelCm.toFixed(1) + ' cm';
    } else if (configUnit === 'in') {
      let levelIn = (tankDepth - distance) / 2.54;
      if (levelIn < 0) levelIn = 0;
      label = levelIn.toFixed(1) + ' in';
    } else {
      label = percent.toFixed(1) + ' %';
    }
    animateTank(percent, label);
  });
}
setInterval(pollLevel, 1200);
window.addEventListener('DOMContentLoaded', pollLevel);
</script>
<script src="/script.js"></script>
{{FOOTER}}
</body>
</html> 